<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Number base conversions</title>

    <style>
        * {
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;

            padding: 1rem 20%;

            background-color: #EEE;
        }

        label {
            margin-left: 1rem;
        }
        input, select {
            margin: 0.2rem;
            padding: 0.2rem;
        }

        .submit {
            width: 50%;
            margin: 1rem 20%;
        }
    
        .hidden {
            display: none;
        }
    </style>

</head>
<body>
    <h1>Number base conversion exercises</h1>

    <div id="exerciseForm">
        <form action="javascript:void(0)">
            <fieldset>
                <label for="fromBaseSelect">Min base:</label> <select name="fromBase" id="fromBaseSelect">
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                </select>
                <label for="toBaseSelect">Max base:</label> <select name="toBase" id="toBaseSelect">
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                </select>
                <label for="numDigitsSelect">Number of digits:</label> <select name="numDigits" id="numDigitsSelect">
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select></br>
                <input type="submit" value="Start" onClick="startExercises()" class="submit"/>
            </fieldset>
        </form>
    </div>

    <div id="exercises" class="hidden">
        <div id="exerciseCalculations">

        </div>
        <form action="javascript:void(0)">
            <input type="submit" value="Next" onClick="nextExercise()" class="submit"/>
        </form>
    </div>
</body>

<script>

    const NUMBER_STRING = "0123456789abcdefghijklmnopqrstuvwxyz";

    let minBase = 2;
    let maxBase = 20;
    let numDigits = 2;

    let exercises = [];

    function convertToBase(number, base) {
        console.log(`CONVERT TO BASE: ${number} into ${base}`);
        let result = [];
        while (number > 0) {
            result.push(number % base);
            number = Math.floor(number / base);
            console.log(`  ${number} % ${base} = ${number % base}, ${number} / ${base} = ${number / base}`);
        }
        console.log(`  --Result: ${JSON.stringify(result)}`);
        let returnString = "";
        for (let i = result.length-1; i >= 0; i--) {
            returnString += NUMBER_STRING[result[i]];
        }
        console.log(`  --Return: ${returnString}`);
        return returnString;
    }

    function readInputs() {
        minBase = parseInt(document.getElementById("fromBaseSelect").value);
        maxBase = parseInt(document.getElementById("toBaseSelect").value);
        if (maxBase <= minBase) {
            console.log(`MaxBase (${maxBase}) cannot be lower than or equal to the MinBase (${minBase})! Adjusting value..`);
            maxBase = minBase+1;
        }
        numDigits = parseInt(document.getElementById("numDigitsSelect").value);
    }

    function startExercises() {
        readInputs();
        document.getElementById("exerciseForm").classList.add("hidden");
        document.getElementById("exercises").classList.remove("hidden");
        console.log("Exercises started!");
        console.log(`MinBase: ${minBase}`);
        console.log(`MaxBase: ${maxBase}`);
        console.log(`NumDigits: ${numDigits}`);
        nextExercise();
    }
    function nextExercise() {
        minNum = minNumber(numDigits);
        maxNum = maxNumber(numDigits);
        console.log(`MinNum: ${minNum}, MaxNum: ${maxNum}`);

        let number = Math.floor(Math.random() * (maxNum - minNum) + minNum);
        let fromBase = Math.floor(Math.random() * (maxBase - minBase) + minBase);
        let toBase = Math.floor(Math.random() * (maxBase - minBase) + minBase);
        console.log(`Number: ${number}, FromBase: ${fromBase}, ToBase: ${toBase}`);

        let result = convertToBase(number, toBase);
        number = convertToBase(number, fromBase);

        exercises.push({num: number, fromBase: fromBase, toBase: toBase, result: result});
        showExercises();
    }
    function showExercises() {
        const divCalculations = document.getElementById("exerciseCalculations");
        divCalculations.innerHTML = "";
        // console.log(`Exercises: ${JSON.stringify(exercises)}`);
        for (let i = 0; i < exercises.length; i++) {
            const exercise = exercises[i];
            let outputString = "<p>";
            // console.log(`  Entry: ${JSON.stringify(exercise)}`);
            outputString += `<b>${exercise["num"]}</b> from base <b>${exercise["fromBase"]}</b> into <b>${exercise["toBase"]}</b> =`;
            if (i+1 < exercises.length) {
                outputString += ` ${exercise["result"]}`;
            }
            outputString += "</p>";
            divCalculations.innerHTML += outputString;
        }
    }

    function minNumber(numDigits) {
        switch (numDigits) {
            case 2: return 10;
            case 3: return 100;
            case 4: return 1000;
            default: return 10000;
        }
    }
    function maxNumber(numDigits) {
        switch (numDigits) {
            case 2: return 99;
            case 3: return 999;
            case 4: return 9999;
            default: return 99999;
        }
    }
</script>

</html>